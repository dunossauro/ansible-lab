
<!doctype html>
<html lang="pt" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../images/ansible_logo.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>Playbooks - Ansible lab</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.472b142f.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.08040f6c.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="None" data-md-color-accent="None">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#playbooks" class="md-skip">
          Ir para o conteúdo
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabeçalho">
    <a href=".." title="Ansible lab" class="md-header__button md-logo" aria-label="Ansible lab" data-md-component="logo">
      
  <img src="../images/ansible_logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Ansible lab
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Playbooks
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/dunossauro/ansible-lab" title="Ir ao repositório" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    dunossauro/ansible-lab
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navegação" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Ansible lab" class="md-nav__button md-logo" aria-label="Ansible lab" data-md-component="logo">
      
  <img src="../images/ansible_logo.png" alt="logo">

    </a>
    Ansible lab
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/dunossauro/ansible-lab" title="Ir ao repositório" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    dunossauro/ansible-lab
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Tutorial introdutório de Ansible :snake:
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../00_jaba/" class="md-nav__link">
        Jabá
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../01_configuracao_do_ambiente/" class="md-nav__link">
        Configuração do ambiente
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../02_o_basico_necessario_sobre_vagrant/" class="md-nav__link">
        Básico necessário sobre Vagrant
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../03_ansible_basico/" class="md-nav__link">
        Ansible básico
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../04_configuracao_do_ansible/" class="md-nav__link">
        Entendendo a estrutura do ansible
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Playbooks
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Playbooks
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Índice">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Índice
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#arquivos-yaml" class="md-nav__link">
    Arquivos YAML
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nosso-primeiro-playbook" class="md-nav__link">
    Nosso primeiro playbook
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mais-um-playbook" class="md-nav__link">
    Mais um playbook
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#condicionais" class="md-nav__link">
    Condicionais
  </a>
  
    <nav class="md-nav" aria-label="Condicionais">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#o-modulo-setup" class="md-nav__link">
    O módulo setup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-clausula-when" class="md-nav__link">
    A clausula when
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#expressoes-e-variaveis" class="md-nav__link">
    Expressões e variáveis
  </a>
  
    <nav class="md-nav" aria-label="Expressões e variáveis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#expressoes" class="md-nav__link">
    Expressões
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#as-variaveis-no-ansible" class="md-nav__link">
    As variáveis no ansible
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variaveis-no-playbook" class="md-nav__link">
    Variáveis no playbook
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variaveis-via-linha-de-comando" class="md-nav__link">
    Variáveis via linha de comando
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arquivos-de-variaveis" class="md-nav__link">
    Arquivos de variáveis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arquivos-de-variaveis-por-grupo" class="md-nav__link">
    Arquivos de variáveis por grupo
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../06_tasks/" class="md-nav__link">
        Tasks
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../07_ansible_galaxy/" class="md-nav__link">
        Ansible Galaxy
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../99_problemas_comuns/" class="md-nav__link">
        Alguns problemas que podem acontecer
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../referencias/" class="md-nav__link">
        Referências
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Índice">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Índice
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#arquivos-yaml" class="md-nav__link">
    Arquivos YAML
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nosso-primeiro-playbook" class="md-nav__link">
    Nosso primeiro playbook
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mais-um-playbook" class="md-nav__link">
    Mais um playbook
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#condicionais" class="md-nav__link">
    Condicionais
  </a>
  
    <nav class="md-nav" aria-label="Condicionais">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#o-modulo-setup" class="md-nav__link">
    O módulo setup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-clausula-when" class="md-nav__link">
    A clausula when
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#expressoes-e-variaveis" class="md-nav__link">
    Expressões e variáveis
  </a>
  
    <nav class="md-nav" aria-label="Expressões e variáveis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#expressoes" class="md-nav__link">
    Expressões
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#as-variaveis-no-ansible" class="md-nav__link">
    As variáveis no ansible
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variaveis-no-playbook" class="md-nav__link">
    Variáveis no playbook
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variaveis-via-linha-de-comando" class="md-nav__link">
    Variáveis via linha de comando
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arquivos-de-variaveis" class="md-nav__link">
    Arquivos de variáveis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arquivos-de-variaveis-por-grupo" class="md-nav__link">
    Arquivos de variáveis por grupo
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/dunossauro/ansible-lab/tree/main/docs/05_playbooks.md" title="Editar esta página" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="playbooks">Playbooks</h1>
<p>Tudo que executamos até agora foram comandos no terminal com ansible. Você deve estar se perguntando se não seria mais fácil criar um script com todos esses comandos, para evitar ter que digitar todas às vezes. Para isso existem os playbooks. Você cria um arquivo no formato <a href="https://yaml.org/">yaml</a> descrevendo todas as suas tarefas e executa de uma única vez.</p>
<div class="admonition tip">
<p class="admonition-title">O nome Playbook</p>
<p>Playbook é uma palavra que se refere a scripts de teatro. Por exemplo, quando alguém entra em cena, as falas de cada personagem, etc.</p>
<p>No mundo dos esportes, playbook é usado muito no beisebol e no basquete. São listas de jogadas que podem ser feitas durante um jogo.</p>
</div>
<h2 id="arquivos-yaml">Arquivos YAML</h2>
<p>Arquivos YAML são arquivos geralmente usados para configurações. Se pensarmos em Python, eles formam estruturas equivalentes a de dicionários. Uma comparação básica para você entender o formato:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">YAML</label><label for="__tabbed_1_2">Python</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-0-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-0-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="nn">---</span><span class="w"></span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="nt">chave</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">valor</span><span class="w">      </span><span class="c1"># valor é uma string</span><span class="w"></span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="nt">chave_int</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w">      </span><span class="c1"># valor é uma int</span><span class="w"></span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="nt">chave_bool</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># valor é uma bool</span><span class="w"></span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="nt">uma_lista</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">item_0</span><span class="w"></span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">item_1</span><span class="w"></span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">item_2</span><span class="w"></span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="nt">um_dict</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="w">  </span><span class="nt">nome</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eduardo</span><span class="w"></span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="w">  </span><span class="nt">idade</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">29</span><span class="w"></span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="c1"># Comentários</span><span class="w"></span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="nt">lista_inline</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;item_0&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;item_1&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;item_2&#39;</span><span class="p p-Indicator">]</span><span class="w"></span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="nt">dict_inline</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="s">&#39;nome&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&#39;eduardo&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;idade&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">29</span><span class="p p-Indicator">}</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span>
<span class="normal"><a href="#__codelineno-1-13">13</a></span>
<span class="normal"><a href="#__codelineno-1-14">14</a></span>
<span class="normal"><a href="#__codelineno-1-15">15</a></span>
<span class="normal"><a href="#__codelineno-1-16">16</a></span>
<span class="normal"><a href="#__codelineno-1-17">17</a></span>
<span class="normal"><a href="#__codelineno-1-18">18</a></span>
<span class="normal"><a href="#__codelineno-1-19">19</a></span>
<span class="normal"><a href="#__codelineno-1-20">20</a></span>
<span class="normal"><a href="#__codelineno-1-21">21</a></span>
<span class="normal"><a href="#__codelineno-1-22">22</a></span>
<span class="normal"><a href="#__codelineno-1-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="p">{</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a>    <span class="s2">&quot;chave&quot;</span><span class="p">:</span> <span class="s2">&quot;valor&quot;</span><span class="p">,</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a>    <span class="s2">&quot;chave_int&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a>    <span class="s2">&quot;chave_bool&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a>    <span class="s2">&quot;uma_lista&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a>        <span class="s2">&quot;item_0&quot;</span><span class="p">,</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a>        <span class="s2">&quot;item_1&quot;</span><span class="p">,</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a>        <span class="s2">&quot;item_2&quot;</span>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a>    <span class="p">],</span>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a>    <span class="s2">&quot;um_dict&quot;</span><span class="p">:</span>  <span class="p">{</span>
<a id="__codelineno-1-11" name="__codelineno-1-11"></a>        <span class="s2">&quot;nome&quot;</span><span class="p">:</span> <span class="s2">&quot;eduardo&quot;</span><span class="p">,</span>
<a id="__codelineno-1-12" name="__codelineno-1-12"></a>        <span class="s2">&quot;idade&quot;</span><span class="p">:</span> <span class="mi">29</span>
<a id="__codelineno-1-13" name="__codelineno-1-13"></a>    <span class="p">},</span>
<a id="__codelineno-1-14" name="__codelineno-1-14"></a>    <span class="s2">&quot;lista_inline&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-1-15" name="__codelineno-1-15"></a>        <span class="s2">&quot;item_0&quot;</span><span class="p">,</span>
<a id="__codelineno-1-16" name="__codelineno-1-16"></a>        <span class="s2">&quot;item_1&quot;</span><span class="p">,</span>
<a id="__codelineno-1-17" name="__codelineno-1-17"></a>        <span class="s2">&quot;item_2&quot;</span>
<a id="__codelineno-1-18" name="__codelineno-1-18"></a>    <span class="p">],</span>
<a id="__codelineno-1-19" name="__codelineno-1-19"></a>    <span class="s2">&quot;dict_inline&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-1-20" name="__codelineno-1-20"></a>        <span class="s2">&quot;nome&quot;</span><span class="p">:</span> <span class="s2">&quot;eduardo&quot;</span><span class="p">,</span>
<a id="__codelineno-1-21" name="__codelineno-1-21"></a>        <span class="s2">&quot;idade&quot;</span><span class="p">:</span> <span class="mi">29</span>
<a id="__codelineno-1-22" name="__codelineno-1-22"></a>    <span class="p">}</span>
<a id="__codelineno-1-23" name="__codelineno-1-23"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<h2 id="nosso-primeiro-playbook">Nosso primeiro playbook</h2>
<p>Vamos reproduzir a instalação e configuração do Ngix que fizemos via comandos <code>ad-hoc</code> no terminal:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">web_server.yml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-2-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-2-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-2-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-2-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-2-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-2-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-2-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-2-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-2-10">10</a></span>
<span class="normal"><a href="#__codelineno-2-11">11</a></span>
<span class="normal"><a href="#__codelineno-2-12">12</a></span>
<span class="normal"><a href="#__codelineno-2-13">13</a></span>
<span class="normal"><a href="#__codelineno-2-14">14</a></span>
<span class="normal"><a href="#__codelineno-2-15">15</a></span>
<span class="normal"><a href="#__codelineno-2-16">16</a></span>
<span class="normal"><a href="#__codelineno-2-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="nn">---</span><span class="w"></span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Instalação do nginx</span><span class="w"></span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">linux</span><span class="w">   </span><span class="c1"># Grupo de hosts do inventário</span><span class="w"></span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span><span class="w">    </span><span class="c1"># Diz que vai escalonar privilégios. Equivalente ao <mark class="critic">-b</mark></span><span class="w"></span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span><span class="w">  </span><span class="c1"># Descrição das tarefas que serão executadas</span><span class="w"></span>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Instalação do nginx</span><span class="w">  </span><span class="c1"># Nome da tarefa</span><span class="w"></span>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="w">      </span><span class="nt">package</span><span class="p">:</span><span class="w">                   </span><span class="c1"># Nome do módulo</span><span class="w"></span>
<a id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="w">        </span><span class="c1"># Argumentos do módulo</span><span class="w"></span>
<a id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span><span class="w"></span>
<a id="__codelineno-2-12" name="__codelineno-2-12"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span><span class="w"></span>
<a id="__codelineno-2-13" name="__codelineno-2-13"></a>
<a id="__codelineno-2-14" name="__codelineno-2-14"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Inicialização do nginx</span><span class="w"></span>
<a id="__codelineno-2-15" name="__codelineno-2-15"></a><span class="w">      </span><span class="nt">systemd</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-2-16" name="__codelineno-2-16"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">started</span><span class="w"></span>
<a id="__codelineno-2-17" name="__codelineno-2-17"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<p>Dessa forma, no lugar de executar um único comando por vez, podemos disparar um playbook que executa diversas tarefas por vez:</p>
<div class="highlight"><span class="filename">$ Execução no terminal</span><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>ansible-playbook web_server.yml
</code></pre></div>
<p>Você deve ver uma grande resposta como essa:</p>
<div class="highlight"><span class="filename">resposta do terminal</span><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>ansible-playbook web_server.yml
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>PLAY <span class="o">[</span>Instalação <span class="k">do</span> nginx<span class="o">]</span> *****************************************************
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>TASK <span class="o">[</span>Gathering Facts<span class="o">]</span> *********************************************************
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>ok: <span class="o">[</span><span class="m">10</span>.0.2.15<span class="o">]</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>ok: <span class="o">[</span><span class="m">10</span>.0.2.16<span class="o">]</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>TASK <span class="o">[</span>Instalação <span class="k">do</span> nginx<span class="o">]</span> *****************************************************
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>ok: <span class="o">[</span><span class="m">10</span>.0.2.15<span class="o">]</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>ok: <span class="o">[</span><span class="m">10</span>.0.2.16<span class="o">]</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>TASK <span class="o">[</span>Inicialização <span class="k">do</span> nginx<span class="o">]</span> **************************************************
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>ok: <span class="o">[</span><span class="m">10</span>.0.2.15<span class="o">]</span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>ok: <span class="o">[</span><span class="m">10</span>.0.2.16<span class="o">]</span>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>PLAY RECAP *********************************************************************
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a><span class="m">10</span>.0.2.15   : <span class="nv">ok</span><span class="o">=</span><span class="m">3</span>  <span class="nv">changed</span><span class="o">=</span><span class="m">0</span>  <span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span>  <span class="nv">failed</span><span class="o">=</span><span class="m">0</span>  <span class="nv">skipped</span><span class="o">=</span><span class="m">0</span>  <span class="nv">rescued</span><span class="o">=</span><span class="m">0</span>  <span class="nv">ignored</span><span class="o">=</span><span class="m">0</span>
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="m">10</span>.0.2.16   : <span class="nv">ok</span><span class="o">=</span><span class="m">3</span>  <span class="nv">changed</span><span class="o">=</span><span class="m">0</span>  <span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span>  <span class="nv">failed</span><span class="o">=</span><span class="m">0</span>  <span class="nv">skipped</span><span class="o">=</span><span class="m">0</span>  <span class="nv">rescued</span><span class="o">=</span><span class="m">0</span>  <span class="nv">ignored</span><span class="o">=</span><span class="m">0</span>
</code></pre></div>
<p>O que significa que o ansible conseguiu executar o playbook com sucesso.</p>
<h2 id="mais-um-playbook">Mais um playbook</h2>
<p>Sei que você já deve ter captado a ideia do playbook, mas que tal criarmos mais um? Vamos tentar reproduzir a configuração do emacs no localhost agora. Pois temos outros módulos e outros comandos para aprender:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">emacs.yml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span>
<span class="normal"><a href="#__codelineno-5-12">12</a></span>
<span class="normal"><a href="#__codelineno-5-13">13</a></span>
<span class="normal"><a href="#__codelineno-5-14">14</a></span>
<span class="normal"><a href="#__codelineno-5-15">15</a></span>
<span class="normal"><a href="#__codelineno-5-16">16</a></span>
<span class="normal"><a href="#__codelineno-5-17">17</a></span>
<span class="normal"><a href="#__codelineno-5-18">18</a></span>
<span class="normal"><a href="#__codelineno-5-19">19</a></span>
<span class="normal"><a href="#__codelineno-5-20">20</a></span>
<span class="normal"><a href="#__codelineno-5-21">21</a></span>
<span class="normal"><a href="#__codelineno-5-22">22</a></span>
<span class="normal"><a href="#__codelineno-5-23">23</a></span>
<span class="normal"><a href="#__codelineno-5-24">24</a></span>
<span class="normal"><a href="#__codelineno-5-25">25</a></span>
<span class="normal"><a href="#__codelineno-5-26">26</a></span>
<span class="normal"><a href="#__codelineno-5-27">27</a></span>
<span class="normal"><a href="#__codelineno-5-28">28</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="nn">---</span><span class="w"></span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Instalação e configuração do emacs</span><span class="w"></span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">localhost</span><span class="w">  </span><span class="c1"># Aqui mudamos para o localhost</span><span class="w"></span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Instalação do emacs</span><span class="w"></span>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="w">      </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span><span class="w">  </span><span class="c1"># Diferente da outra config, somente esse passo será como root</span><span class="w"></span>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a><span class="w">      </span><span class="nt">package</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-5-11" name="__codelineno-5-11"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span><span class="w"></span>
<a id="__codelineno-5-12" name="__codelineno-5-12"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">emacs</span><span class="w"></span>
<a id="__codelineno-5-13" name="__codelineno-5-13"></a>
<a id="__codelineno-5-14" name="__codelineno-5-14"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Instalação do git</span><span class="w"></span>
<a id="__codelineno-5-15" name="__codelineno-5-15"></a><span class="w">      </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span><span class="w"></span>
<a id="__codelineno-5-16" name="__codelineno-5-16"></a><span class="w">      </span><span class="nt">package</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-5-17" name="__codelineno-5-17"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">git</span><span class="w"></span>
<a id="__codelineno-5-18" name="__codelineno-5-18"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span><span class="w"></span>
<a id="__codelineno-5-19" name="__codelineno-5-19"></a>
<a id="__codelineno-5-20" name="__codelineno-5-20"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Clone do nosso repositório</span><span class="w"></span>
<a id="__codelineno-5-21" name="__codelineno-5-21"></a><span class="w">      </span><span class="nt">git</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-5-22" name="__codelineno-5-22"></a><span class="w">        </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/dunossauro/dotfiles.git</span><span class="w"></span>
<a id="__codelineno-5-23" name="__codelineno-5-23"></a><span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config_files</span><span class="w"></span>
<a id="__codelineno-5-24" name="__codelineno-5-24"></a>
<a id="__codelineno-5-25" name="__codelineno-5-25"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Movendo os arquivos de configuração do emacs</span><span class="w"></span>
<a id="__codelineno-5-26" name="__codelineno-5-26"></a><span class="w">      </span><span class="nt">copy</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-5-27" name="__codelineno-5-27"></a><span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/vagrant/</span><span class="w"></span>
<a id="__codelineno-5-28" name="__codelineno-5-28"></a><span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/vagrant/config_files/.emacs.d</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<p>Se executarmos esse playbook podemos ver algumas mensagens diferentes na resposta:</p>
<div class="highlight"><span class="filename">$ Execução no terminal</span><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>ansible-playbook emacs.yml
</code></pre></div>
<p>A resposta:</p>
<p><div class="highlight"><span class="filename">resposta do terminal</span><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>PLAY <span class="o">[</span>Instalação e configuração <span class="k">do</span> emacs<span class="o">]</span> **************************************
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>TASK <span class="o">[</span>Gathering Facts<span class="o">]</span> *********************************************************
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>ok: <span class="o">[</span>localhost<span class="o">]</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>TASK <span class="o">[</span>Instalação <span class="k">do</span> emacs<span class="o">]</span> *****************************************************
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>ok: <span class="o">[</span>localhost<span class="o">]</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>TASK <span class="o">[</span>Instalação <span class="k">do</span> git<span class="o">]</span> *******************************************************
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>ok: <span class="o">[</span>localhost<span class="o">]</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>TASK <span class="o">[</span>Clone <span class="k">do</span> nosso repositório<span class="o">]</span> **********************************************
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><mark class="critic">changed</mark>: <span class="o">[</span>localhost<span class="o">]</span>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>TASK <span class="o">[</span>Movendo os arquivos de configuração <span class="k">do</span> emacs<span class="o">]</span> ****************************
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><mark class="critic">changed</mark>: <span class="o">[</span>localhost<span class="o">]</span>
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a>
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a>PLAY RECAP *********************************************************************
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a>localhost  : <span class="nv">ok</span><span class="o">=</span><span class="m">5</span>  <mark class="critic">changed<span class="o">=</span><span class="m">2</span></mark>  <span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span>  <span class="nv">failed</span><span class="o">=</span><span class="m">0</span>  <span class="nv">skipped</span><span class="o">=</span><span class="m">0</span>  <span class="nv">rescued</span><span class="o">=</span><span class="m">0</span>  <span class="nv">ignored</span><span class="o">=</span><span class="m">0</span>
</code></pre></div>
O status <code>changed</code> apareceu. Significa que o resultado desse comando foi diferente da primeira vez que foi executado. O que quer dizer que alguma coisa mudou desde a última execução.</p>
<p>Provavelmente a resposta do ansible foi diferente, pois o clone não foi feito, o diretório já existia e o move também já tinha sido feito antes.</p>
<h2 id="condicionais">Condicionais</h2>
<p>Vamos recapitular mais uma coisa que já instalamos no nosso ambiente. O <code>pipx</code> e o <code>httpie</code>. Não são pacotes tão relevantes para o andamento do tutorial, mas precisamos aprender coisas legais com ansible antes de fazer coisas realmente úteis.</p>
<p>O pacote do <code>pipx</code> existe no repositório do <code>archlinux</code> como já vimos. O pacote se chama <code>python-pipx</code>. Vamos iniciar um playbook para essa instalação e ver os problemas que vamos encontrar no caminho:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">pipx_httpie.yml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-8-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-8-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-8-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-8-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-8-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-8-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-8-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-8-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-8-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="nn">---</span><span class="w"></span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Instalação do pipx e httpie</span><span class="w"></span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">linux</span><span class="w">  </span><span class="c1"># vale lembrar aqui que um dos linux é o arch e o outro o ubuntu</span><span class="w"></span>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Instalação do pipx</span><span class="w"></span>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="w">      </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span><span class="w"></span>
<a id="__codelineno-8-8" name="__codelineno-8-8"></a><span class="w">      </span><span class="nt">package</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-9" name="__codelineno-8-9"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python-pipx</span><span class="w"></span>
<a id="__codelineno-8-10" name="__codelineno-8-10"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<p>Vamos executar para ver o que conseguimos com isso:</p>
<div class="highlight"><span class="filename">$ Execução no terminal</span><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>ansible-playbook pipx_httpie.yml
</code></pre></div>
<p>Obteremos a seguinte resposta:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>PLAY [Instalação do pipx e httpie] *********************************************
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>TASK [Gathering Facts] *********************************************************
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>ok: [10.0.2.15]
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>ok: [10.0.2.16]
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>TASK [Instalação do pipx] ******************************************************
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><mark class="critic">fatal: [10.0.2.15]: FAILED! =&gt; {&quot;changed&quot;: false, &quot;msg&quot;: &quot;No package matching &#39;python-pipx&#39; is available&quot;}</mark>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>changed: [10.0.2.16]
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>PLAY RECAP *********************************************************************
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>10.0.2.15  : ok=1  changed=0  unreachable=0  failed=1  skipped=0  rescued=0  ignored=0
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>10.0.2.16  : ok=2  changed=1  unreachable=0  failed=0  skipped=0  rescued=0  ignored=0
</code></pre></div>
<p>Repare na linha destacada. A máquina associada ao ip <code>10.2.2.15</code> não tem um pacote no repositório chamado <code>python-pipx</code>. Esse foi o motivo da falha. O pacote existe no repositório do arch, porém não existe no repositório do ubuntu.</p>
<p>Para resolver esse problema precisamos descobrir o nome do pacote no <a href="https://packages.ubuntu.com/">repositório do ubuntu</a>. E para saber isso precisamos saber qual a versão do ubuntu estamos usando. Você deve se lembrar que escrever no Vagrantfile <code>ubuntu/focal64</code>. Então, sabemos que a versão é a <code>focal</code>. Porém, se não soubéssemos essa informação. Como o ansible poderia nos ajudar a descobrir?</p>
<h3 id="o-modulo-setup">O módulo setup</h3>
<p>O Ansible conta com um módulo chamado <a href="https://docs.ansible.com/ansible/2.7/modules/setup_module.html#setup-module">setup</a>. Esse módulo pode ser chamado via ad-hoc, mas também é a base para algumas variáveis nos playbooks. Primeiro vamos executar via ad-hoc:</p>
<div class="highlight"><span class="filename">$ Execução no terminal</span><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>ansible ubuntu -m setup
</code></pre></div>
<p>Esse comando nos retornará uma resposta MUITO extensa. Que acabei deixando em um arquivo separado. Você pode acessar <a href="https://github.com/dunossauro/ansible-lab/blob/main/stuff/resposta_ubuntu_setup.txt">aqui</a>. Vamos destacar somente algumas coisas que fazem sentido para nosso passo atual:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-344">344</a></span>
<span class="normal"><a href="#__codelineno-12-345">345</a></span>
<span class="normal"><a href="#__codelineno-12-346">346</a></span>
<span class="normal"><a href="#__codelineno-12-347">347</a></span>
<span class="normal"><a href="#__codelineno-12-348">348</a></span>
<span class="normal"><a href="#__codelineno-12-349">349</a></span>
<span class="normal"><a href="#__codelineno-12-350">350</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-344" name="__codelineno-12-344"></a><span class="nt">&quot;ansible_distribution&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Ubuntu&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-12-345" name="__codelineno-12-345"></a><span class="nt">&quot;ansible_distribution_file_parsed&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-12-346" name="__codelineno-12-346"></a><span class="nt">&quot;ansible_distribution_file_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/etc/os-release&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-12-347" name="__codelineno-12-347"></a><span class="nt">&quot;ansible_distribution_file_variety&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Debian&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-12-348" name="__codelineno-12-348"></a><span class="nt">&quot;ansible_distribution_major_version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;20&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-12-349" name="__codelineno-12-349"></a><span class="nt">&quot;ansible_distribution_release&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;focal&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-12-350" name="__codelineno-12-350"></a><span class="nt">&quot;ansible_distribution_version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;20.04&quot;</span><span class="p">,</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<p>Podemos ver que o ansible sabe qual a distribuição que está sendo usada <code>Ubuntu</code>, qual a versão do sistema <code>20.04</code> e a release que está sendo executada <code>focal</code>. O <code>setup</code> consegue mostrar diversos outros dados. Sobre as interfaces de rede, sobre memória, etc.</p>
<p>Aproveitando que já estamos vendo o módulo <code>setup</code>, podemos usar a função de filtro do módulo para exibir somente as informações que precisamos. Qualquer coisa que comece com <code>ansible_distribution</code>:</p>
<div class="highlight"><span class="filename">$ Execução no terminal</span><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>ansible ubuntu -m setup -a <span class="s2">&quot;filter=ansible_distribution*&quot;</span>
</code></pre></div>
<p>Que nos retornará os mesmos dados que destaquei:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>10.0.2.15 | SUCCESS =&gt; {
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>    &quot;ansible_facts&quot;: {
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>        &quot;ansible_distribution&quot;: &quot;Ubuntu&quot;,
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>        &quot;ansible_distribution_file_parsed&quot;: true,
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>        &quot;ansible_distribution_file_path&quot;: &quot;/etc/os-release&quot;,
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>        &quot;ansible_distribution_file_variety&quot;: &quot;Debian&quot;,
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>        &quot;ansible_distribution_major_version&quot;: &quot;20&quot;,
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>        &quot;ansible_distribution_release&quot;: &quot;focal&quot;,
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>        &quot;ansible_distribution_version&quot;: &quot;20.04&quot;,
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>        &quot;discovered_interpreter_python&quot;: &quot;/usr/bin/python3&quot;
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>    },
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>    &quot;changed&quot;: false
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>}
</code></pre></div>
<p>Agora que sabemos que é o Ubuntu Focal, podemos voltar ao repositório. O pacote existe, porém, com outro nome <a href="https://packages.ubuntu.com/focal/python/pipx">pipx</a>.</p>
<h3 id="a-clausula-when">A clausula <code>when</code></h3>
<p>Como disse, as variáveis do setup podem ser invocadas dentro do playbook. Dessa forma podemos criar validações condicionais no nosso playbook. Vamos criar uma restrição para que a task seja executada somente no arch linux:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">pipx_httpie.yml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-15-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-15-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-15-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-15-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-15-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-15-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-15-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-15-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-15-10">10</a></span>
<span class="normal"><a href="#__codelineno-15-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="nn">---</span><span class="w"></span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Instalação do pipx e httpie</span><span class="w"></span>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">linux</span><span class="w">  </span><span class="c1"># vale lembrar aqui que um dos linux é o arch e o outro o ubuntu</span><span class="w"></span>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Instalação do pipx <ins class="critic">no Arch</ins></span><span class="w"></span>
<a id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="w">      </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span><span class="w"></span>
<a id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="w">      </span><span class="nt">package</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-15-9" name="__codelineno-15-9"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python-pipx</span><span class="w"></span>
<a id="__codelineno-15-10" name="__codelineno-15-10"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span><span class="w"></span>
<a id="__codelineno-15-11" name="__codelineno-15-11"></a><span class="w">      </span><span class="l l-Scalar l-Scalar-Plain"><ins class="critic">when</ins></span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain"><ins class="critic">ansible_distribution == Archlinux&#39;</ins></span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<blockquote>
<p>As linhas destacadas mostra somente as alterações que fizemos no playbook.</p>
</blockquote>
<p>Dessa forma, a task <code>Instalação do pipx no Arch</code> só será executada quando a distribuição for <code>Archlinux</code>. Vamos testar:</p>
<div class="highlight"><span class="filename">$ Execução no terminal</span><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>ansible-playbook pipx_httpie.yml
</code></pre></div>
<div class="highlight"><span class="filename">Resultado do shell</span><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>PLAY <span class="o">[</span>Instalação <span class="k">do</span> pipx e httpie<span class="o">]</span> ********************************************************
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>TASK <span class="o">[</span>Gathering Facts<span class="o">]</span> ********************************************************************
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>ok: <span class="o">[</span><span class="m">10</span>.0.2.15<span class="o">]</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>ok: <span class="o">[</span><span class="m">10</span>.0.2.16<span class="o">]</span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>TASK <span class="o">[</span>Instalação <span class="k">do</span> pipx no Arch<span class="o">]</span> *********************************************************
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><mark class="critic">skipping: <span class="o">[</span><span class="m">10</span>.0.2.15<span class="o">]</span></mark>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>ok: <span class="o">[</span><span class="m">10</span>.0.2.16<span class="o">]</span>
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>PLAY RECAP ********************************************************************************
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="m">10</span>.0.2.16  : <span class="nv">ok</span><span class="o">=</span><span class="m">2</span>  <span class="nv">changed</span><span class="o">=</span><span class="m">0</span>  <span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span>  <span class="nv">failed</span><span class="o">=</span><span class="m">0</span>  <span class="nv">skipped</span><span class="o">=</span><span class="m">0</span>  <span class="nv">rescued</span><span class="o">=</span><span class="m">0</span>  <span class="nv">ignored</span><span class="o">=</span><span class="m">0</span> 
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a><span class="m">10</span>.0.2.15  : <span class="nv">ok</span><span class="o">=</span><span class="m">1</span>  <span class="nv">changed</span><span class="o">=</span><span class="m">0</span>  <span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span>  <span class="nv">failed</span><span class="o">=</span><span class="m">0</span>  <mark class="critic">skipped<span class="o">=</span><span class="m">1</span></mark>  <span class="nv">rescued</span><span class="o">=</span><span class="m">0</span>  <span class="nv">ignored</span><span class="o">=</span><span class="m">0</span>
</code></pre></div>
<p>Com isso, podemos ver o status <code>skipped</code>. Isso quer dizer que o passo de instalar no arch, quando passou pela instalação no ubuntu "pulou" esse passo. Sabendo disso, podemos criar uma nova task específica para o ubuntu que pule no arch também:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">pipx_httpie.yml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-13">13</a></span>
<span class="normal"><a href="#__codelineno-18-14">14</a></span>
<span class="normal"><a href="#__codelineno-18-15">15</a></span>
<span class="normal"><a href="#__codelineno-18-16">16</a></span>
<span class="normal"><a href="#__codelineno-18-17">17</a></span>
<span class="normal"><a href="#__codelineno-18-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-13" name="__codelineno-18-13"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Instalação do pipx no Ubuntu</span><span class="w"></span>
<a id="__codelineno-18-14" name="__codelineno-18-14"></a><span class="w">      </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span><span class="w"></span>
<a id="__codelineno-18-15" name="__codelineno-18-15"></a><span class="w">      </span><span class="nt">package</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-18-16" name="__codelineno-18-16"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pipx</span><span class="w"></span>
<a id="__codelineno-18-17" name="__codelineno-18-17"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span><span class="w"></span>
<a id="__codelineno-18-18" name="__codelineno-18-18"></a><span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_distribution == &#39;Ubuntu&#39;</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<p>Dessa forma, quando executarmos o playbook teremos certeza que a execução vai acontecer nos dois nós. Mesmo que em tasks diferentes.</p>
<div class="highlight"><span class="filename">$ Execução no terminal e a parte importante do resultado</span><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>ansible-playbook pipx_httpie.yml
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>TASK <span class="o">[</span>Instalação <span class="k">do</span> pipx no Arch<span class="o">]</span> *********************************************************
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>skipping: <span class="o">[</span><span class="m">10</span>.0.2.15<span class="o">]</span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>ok: <span class="o">[</span><span class="m">10</span>.0.2.16<span class="o">]</span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a>TASK <span class="o">[</span>Instalação <span class="k">do</span> pipx no Ubuntu<span class="o">]</span> *******************************************************
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a>skipping: <span class="o">[</span><span class="m">10</span>.0.2.16<span class="o">]</span>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a>ok: <span class="o">[</span><span class="m">10</span>.0.2.15<span class="o">]</span>
</code></pre></div>
<p>Desta forma não precisamos mais nos preocupar com os pacotes específicos de cada sistema, podemos criar uma task para cada sistema. Em casos extremos isso pode ser necessário. Mas será que não existe uma forma mais simples de resolver esse problema?</p>
<h2 id="expressoes-e-variaveis">Expressões e variáveis</h2>
<p>Quando chamamos o setup, vimos que o ansible consegue carregar diversas variáveis durante a execução. Mas será que nesse caso não conseguiríamos criar uma variável nossa? Aí poderíamos validar antes e evitar escrever duas tasks.</p>
<h3 id="expressoes">Expressões</h3>
<p>O Ansible usa um motor de templates chamado <a href="https://palletsprojects.com/p/jinja/">Jinja</a>. O jinja fornece uma forma de chamar expressões de código Python dentro de templates. Assim, quando o ansible executa um playbook ele também avalia e executa as expressões do jinja dentro do código.</p>
<p>As expressões no jinja são feitas usando duas chaves delimitador <code>{{ minha_expressão }}</code>. E dentre dessa expressão, qualquer código python pode ser inserido. Por exemplo, podemos fazer um <code>if</code> para resolver nosso caso e ter uma única task. Por exemplo:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">pipx_httpie.yml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-20-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-20-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-20-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-20-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-20-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-5" name="__codelineno-20-5"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-20-6" name="__codelineno-20-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Instalação do pipx</span><span class="w"></span>
<a id="__codelineno-20-7" name="__codelineno-20-7"></a><span class="w">      </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span><span class="w"></span>
<a id="__codelineno-20-8" name="__codelineno-20-8"></a><span class="w">      </span><span class="nt">package</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-20-9" name="__codelineno-20-9"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain"><ins class="critic">&quot;{{ &#39;pipx&#39; if ansible_distribution == &#39;Ubuntu&#39; else &#39;python-pipx&#39;}}&quot;</ins></span><span class="w"></span>
<a id="__codelineno-20-10" name="__codelineno-20-10"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<div class="admonition note">
<p class="admonition-title">Nota sobre expressões no Asnbile</p>
<p>Embora para o jinja somente precise ser usado <code>{{ expressão }}</code>. O Ansible exige que esses blocos estejam também entre aspas. Ficando <code>'{{ expressão }}'</code>.</p>
</div>
<p>Desta forma acabamos resolvendo o problema que tínhamos em ter duas tasks para executar a mesma tarefa em sistemas diferentes. Vamos ver o resultado:</p>
<div class="highlight"><span class="filename">$ Execução no terminal e a parte importante do resultado</span><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>ansible-playbook pipx_httpie.yml
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>TASK <span class="o">[</span>Instalação <span class="k">do</span> pipx no Arch<span class="o">]</span> *********************************************************
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>ok: <span class="o">[</span><span class="m">10</span>.0.2.15<span class="o">]</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>ok: <span class="o">[</span><span class="m">10</span>.0.2.16<span class="o">]</span>
</code></pre></div>
<p>Assim podemos ser mais eficientes em criar regras. Já o que template pode estender código python.</p>
<h3 id="as-variaveis-no-ansible">As variáveis no ansible</h3>
<p>Da mesma forma que podemos criar expressões complexas no jinja. Também podemos chamar somente variáveis. Por exemplo, <code>"{{ variavel }}"</code>. Assim podemos declarar as expressões em um lugar específico do playbook para deixar mais limpo ou passar as mesmas via linha de comando.</p>
<h3 id="variaveis-no-playbook">Variáveis no playbook</h3>
<p>Para isso, podemos trocar o nome do pacote do pipx no playbook para uma variável:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">pipx_httpie.yml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-22-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-22-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-22-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-22-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-22-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-22-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-22-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-22-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-22-10">10</a></span>
<span class="normal"><a href="#__codelineno-22-11">11</a></span>
<span class="normal"><a href="#__codelineno-22-12">12</a></span>
<span class="normal"><a href="#__codelineno-22-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="nn">---</span><span class="w"></span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Instalação do pipx e httpie</span><span class="w"></span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">linux</span><span class="w"></span>
<a id="__codelineno-22-4" name="__codelineno-22-4"></a>
<a id="__codelineno-22-5" name="__codelineno-22-5"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain"><ins class="critic">vars</ins></span><span class="p p-Indicator">:</span><span class="w"></span>
<a id="__codelineno-22-6" name="__codelineno-22-6"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain"><ins class="critic">pipx</ins></span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain"><ins class="critic">&quot;{{ &#39;pipx&#39; if ansible_distribution == &#39;Ubuntu&#39; else &#39;python-pipx&#39;}}&quot;</ins></span><span class="w"></span>
<a id="__codelineno-22-7" name="__codelineno-22-7"></a>
<a id="__codelineno-22-8" name="__codelineno-22-8"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-22-9" name="__codelineno-22-9"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Instalação do pipx</span><span class="w"></span>
<a id="__codelineno-22-10" name="__codelineno-22-10"></a><span class="w">      </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span><span class="w"></span>
<a id="__codelineno-22-11" name="__codelineno-22-11"></a><span class="w">      </span><span class="nt">package</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-22-12" name="__codelineno-22-12"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain"><ins class="critic">&#39;{{ pipx }}&#39;</ins></span><span class="w"></span>
<a id="__codelineno-22-13" name="__codelineno-22-13"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<p>Assim temos um playbook mais limpo. Pois todo o código complicado do jinja fica em um lugar específico e no topo do arquivo para ficar fácil a consulta.</p>
<blockquote>
<p>Não vou executar esse playbook agora, pois teremos o mesmo resultado da execução anterior.</p>
</blockquote>
<h3 id="variaveis-via-linha-de-comando">Variáveis via linha de comando</h3>
<p>Outra funcionalidade importante do ansible é conseguir sobrescrever as variáveis de um playbook usando a linha de comando como base. Chamar via linha de comando tem uma ordem de precedência maior que as variáveis definidas no playbook. Então, quando o ansible for chamado, as variáveis definidas no campo <code>vars</code> serão substituídas pelas variáveis que forem passadas na linha de comando:</p>
<div class="highlight"><span class="filename">$ Execução no terminal e a parte importante do resultado</span><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>ansible-playbook pipx_httpie.yml --extra-vars <span class="s2">&quot;pipx=pipx&quot;</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>TASK <span class="o">[</span>Instalação <span class="k">do</span> pipx<span class="o">]</span> *****************************************************************
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>ok: <span class="o">[</span><span class="m">10</span>.0.2.15<span class="o">]</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>fatal: <span class="o">[</span><span class="m">10</span>.0.2.16<span class="o">]</span>: FAILED! <span class="o">=</span>&gt; <mark class="critic"><span class="o">{</span><span class="s2">&quot;changed&quot;</span>: false, <span class="s2">&quot;cmd&quot;</span>: <span class="o">[</span><span class="s2">&quot;/usr/bin/pacman&quot;</span>, <span class="s2">&quot;--upgrade&quot;</span>, <span class="s2">&quot;--print-format&quot;</span>, <span class="s2">&quot;%n&quot;</span>, <span class="s2">&quot;pipx&quot;</span><span class="o">]</span>, <span class="s2">&quot;msg&quot;</span>: <span class="s2">&quot;Failed to list package pipx&quot;</span>, <span class="s2">&quot;rc&quot;</span>: <span class="m">1</span>, <span class="s2">&quot;stderr&quot;</span>: <span class="s2">&quot;error: &#39;pipx&#39;: could not find or read package\n&quot;</span>, <span class="s2">&quot;stderr_lines&quot;</span>: <span class="o">[</span><span class="s2">&quot;error: &#39;pipx&#39;: could not find or read package&quot;</span><span class="o">]</span>, <span class="s2">&quot;stdout&quot;</span>: <span class="s2">&quot;loading packages...\n&quot;</span>, <span class="s2">&quot;stdout_lines&quot;</span>: <span class="o">[</span><span class="s2">&quot;loading packages...&quot;</span><span class="o">]}</span></mark>
</code></pre></div>
<p>Como era de se esperar, o pacote <code>pipx</code> não existe no arch, seu nome é <code>python-pipx</code> por conta disso, o comando não foi executado com sucesso. Nosso objetivo, porém, era explorar a chamada de variáveis via linha de comando.</p>
<h3 id="arquivos-de-variaveis">Arquivos de variáveis</h3>
<p>Uma forma de evitar expressões do jinja e também chamar variáveis por linha de comando é criar um arquivo só para as variáveis. Dessa forma, caso tenha alguma variável que não possa ser exposta, como endereço de um banco de dados. Esses valores ficam de fora da configuração.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">variaveis.yml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1">1</a></span>
<span class="normal"><a href="#__codelineno-24-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="nn">---</span><span class="w"></span>
<a id="__codelineno-24-2" name="__codelineno-24-2"></a><span class="nt">pipx</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">&#39;pipx&#39;</span><span class="nv"> </span><span class="s">if</span><span class="nv"> </span><span class="s">ansible_distribution</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">&#39;Ubuntu&#39;</span><span class="nv"> </span><span class="s">else</span><span class="nv"> </span><span class="s">&#39;python-pipx&#39;}}&quot;</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<p>Dessa forma podemos limpar o nosso arquivo <code>pipx_httpie.yml</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">pipx_httpie.yml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-25-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-25-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-25-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-25-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-25-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-25-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-25-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-25-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-25-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="nn">---</span><span class="w"></span>
<a id="__codelineno-25-2" name="__codelineno-25-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Instalação do pipx e httpie</span><span class="w"></span>
<a id="__codelineno-25-3" name="__codelineno-25-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">linux</span><span class="w"></span>
<a id="__codelineno-25-4" name="__codelineno-25-4"></a>
<a id="__codelineno-25-5" name="__codelineno-25-5"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-25-6" name="__codelineno-25-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Instalação do pipx</span><span class="w"></span>
<a id="__codelineno-25-7" name="__codelineno-25-7"></a><span class="w">      </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span><span class="w"></span>
<a id="__codelineno-25-8" name="__codelineno-25-8"></a><span class="w">      </span><span class="nt">package</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-25-9" name="__codelineno-25-9"></a><span class="hll"><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">pipx</span><span class="nv"> </span><span class="s">}}&#39;</span><span class="w"></span>
</span><a id="__codelineno-25-10" name="__codelineno-25-10"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<p>E quando formos executar o playbook, só precisamos passar o arquivo de configuração para as variáveis:</p>
<div class="highlight"><span class="filename">$ Execução no terminal e a parte importante do resultado</span><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>ansible-playbook pipx_httpie.yml -e @variaveis.yml
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>TASK <span class="o">[</span>Instalação <span class="k">do</span> pipx<span class="o">]</span> *****************************************************************
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>ok: <span class="o">[</span><span class="m">10</span>.0.2.15<span class="o">]</span>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>ok: <span class="o">[</span><span class="m">10</span>.0.2.16<span class="o">]</span>
</code></pre></div>
<p>Assim demos uma limpada no nosso arquivo de playbook e claro, podemos definir diversas outras variáveis no arquivo. Mas, você pode tentar depois <img alt="❤" class="twemoji" src="https://twemoji.maxcdn.com/v/latest/svg/2764.svg" title=":heart:" /></p>
<h3 id="arquivos-de-variaveis-por-grupo">Arquivos de variáveis por grupo</h3>
<p>Outra coisa que pode facilitar na hora de usar as variáveis é criar variáveis específicas para grupos. O ansible tem um caminho específico para onde esses arquivos de variáveis devem ser colocados: <code>/etc/ansible/group_vars/</code>.</p>
<p>Para resolver isso, vamos criar um grupo de variáveis para o ubuntu:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">/etc/ansible/group_vars/ubuntu.yml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1">1</a></span>
<span class="normal"><a href="#__codelineno-27-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="nn">---</span><span class="w"></span>
<a id="__codelineno-27-2" name="__codelineno-27-2"></a><span class="nt">pipx</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pipx</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<p>e um arquivo para o arch:
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">/etc/ansible/group_vars/arch.yml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1">1</a></span>
<span class="normal"><a href="#__codelineno-28-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="nn">---</span><span class="w"></span>
<a id="__codelineno-28-2" name="__codelineno-28-2"></a><span class="nt">pipx</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python-pipx</span><span class="w"></span>
</code></pre></div></td></tr></table></div></p>
<p>Dessa forma, quando formos executar o playbook não precisamos mais especificar as variáveis comuns. Cada sistema tem sua versão de <code>pipx</code> conforme os grupos do inventário:</p>
<div class="highlight"><span class="filename">$ Execução no terminal e a parte importante do resultado</span><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>ansible-playbook pipx_httpie.yml
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>TASK <span class="o">[</span>Instalação <span class="k">do</span> pipx<span class="o">]</span> *****************************************************************
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>ok: <span class="o">[</span><span class="m">10</span>.0.2.15<span class="o">]</span>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a>ok: <span class="o">[</span><span class="m">10</span>.0.2.16<span class="o">]</span>
</code></pre></div>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Rodapé" >
      
        
        <a href="../04_configuracao_do_ansible/" class="md-footer__link md-footer__link--prev" aria-label="Anterior: Entendendo a estrutura do ansible" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Anterior
              </span>
              Entendendo a estrutura do ansible
            </div>
          </div>
        </a>
      
      
        
        <a href="../06_tasks/" class="md-footer__link md-footer__link--next" aria-label="Próximo: Tasks" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Próximo
              </span>
              Tasks
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://github.com/dunossauro" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://twitter.com/dunossauro" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://youtube.com/dunossauro" target="_blank" rel="noopener" title="youtube.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://instagram.com/dunossauro" target="_blank" rel="noopener" title="instagram.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://www.tiktok.com/@dunossauro" target="_blank" rel="noopener" title="www.tiktok.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M448 209.91a210.06 210.06 0 0 1-122.77-39.25v178.72A162.55 162.55 0 1 1 185 188.31v89.89a74.62 74.62 0 1 0 52.23 71.18V0h88a121.18 121.18 0 0 0 1.86 22.17A122.18 122.18 0 0 0 381 102.39a121.43 121.43 0 0 0 67 20.14Z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.tabs.link"], "search": "../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copiado para \u00e1rea de transfer\u00eancia", "clipboard.copy": "Copiar para \u00e1rea de transfer\u00eancia", "search.config.lang": "pt", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Buscar", "search.result.more.one": "Mais 1 nesta p\u00e1gina", "search.result.more.other": "Mais # nesta p\u00e1gina", "search.result.none": "Nenhum resultado encontrado", "search.result.one": "1 resultado encontrado", "search.result.other": "# resultados encontrados", "search.result.placeholder": "Digite para iniciar a busca", "search.result.term.missing": "Ausente", "select.version.title": "Selecione a vers\u00e3o"}}</script>
    
    
      <script src="../assets/javascripts/bundle.d6c3db9e.min.js"></script>
      
    
  </body>
</html>